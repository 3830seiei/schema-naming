#- metadata -----------------------------------------------
metadata:
  description: テーブル定義書
  author: H.Miyazawa
  history:
  - version: 1.0.0
    date: '2025-06-27'
    author: H.Miyazawa
    comment: OptiServe用のデータベース設計
  - version: 1.1.0
    date: '2025-07-10'
    author: H.Miyazawa
    comment: 'インデックス情報と外部キー情報を追加'
  - version: 1.2.0
    date: '2025-08-13'
    author: H.Miyazawa
    comment: '登録、更新のユーザーIDを追加'
  - version: 1.3.0
    date: '2025-08-22'
    author: H.Miyazawa
    comment: 'ユーザーIDをintegerからtextに変更。'

#- tableinfo ----------------------------------------------
table_name: mst_equipment_classification
description: 医療機関別と公開用（共通）の医療機器分類を管理するマスタテーブル
#- columns info -------------------------------------------
columns:
  - name: classification_id
    description: 機器分類ID
    data_type: serial
    primary_key: true
    nullable: false
    auto_increment: true
    comment: null

  - name: medical_id
    description: 医療機関ID
    data_type: integer
    primary_key: false
    nullable: true
    comment: '医療機関ID。医療機関別の分類の場合は設定される。NULLの場合は公開用の分類。'
    references:
      table: mst_medical_facility
      column: medical_id
      enforced: false  # DB制約無し
      on_delete: restrict  # restrict, cascade, set null, no action
      on_update: restrict
      comment: 'mst_medical_facilityテーブルのmedical_idを参照。医療機関別の分類の場合は設定される。'

  - name: classification_level
    description: レベル（分類の階層）
    data_type: integer
    primary_key: false
    nullable: false
    comment: '分類の階層を示す。1 : 大分類、 2 : 中分類、3 : 小分類。'

  - name: classification_name
    description: 機器分類名
    data_type: text
    primary_key: false
    nullable: false
    comment: '機器分類の名前。'

  - name: parent_classification_id
    description: 親となる機器分類ID
    data_type: integer
    primary_key: false
    nullable: true
    comment: '親となる機器分類のID。NULLの場合は最上位の分類。'
    references:
      table: mst_equipment_classification
      column: classification_id
      enforced: false  # DB制約無し
      on_delete: restrict  # restrict, cascade, set null, no action
      on_update: restrict
      comment: 'mst_equipment_classificationテーブルのclassification_idを参照。親となる機器分類のID。'

  - name: publication_classification_id
    description: 公開用の機器分類ID
    data_type: integer
    primary_key: false
    nullable: true
    comment: '公開用の機器分類ID。医療機関別の分類の場合は基本的に設定されるが分類できないものはNULL。公開用の機器分類の場合はNULL。'
    references:
      table: mst_equipment_classification
      column: classification_id
      enforced: false  # DB制約無し
      on_delete: restrict  # restrict, cascade, set null, no action
      on_update: restrict
      comment: 'mst_equipment_classificationテーブルのclassification_idを参照。公開用の機器分類ID。'

  - name: reg_user_id
    description: 登録ユーザーID
    data_type: text
    primary_key: false
    nullable: false
    comment: 'このレコードの登録を行ったユーザーのID。'
    references:
      table: mst_user
      column: user_id
      enforced: false  # DB制約無し
      on_delete: restrict  # restrict, cascade, set null, no action
      on_update: restrict

  - name: regdate
    description: データ作成日
    data_type: timestamp
    primary_key: false
    nullable: false
    comment: null

  - name: update_user_id
    description: 更新ユーザーID
    data_type: text
    primary_key: false
    nullable: false
    comment: 'このレコードの更新を行ったユーザーのID。'
    references:
      table: mst_user
      column: user_id
      enforced: false  # DB制約無し
      on_delete: restrict  # restrict, cascade, set null, no action
      on_update: restrict

  - name: lastupdate
    description: 最終更新日
    data_type: timestamp
    primary_key: false
    nullable: false
    comment: null

#- indexes info -------------------------------------------
indexes:
- name: idx_mst_equipment_classification_medical_id
  columns: [medical_id]
  unique: false
  note: '医療機関IDのインデックス。医療機関別の機器分類を効率的に検索するためのインデックス。'
- name: idx_mst_equipment_classification_classification_name
  columns: [classification_name]
  unique: false
  note: '機器分類名のインデックス。機器分類名での検索を効率化するためのインデックス。'
